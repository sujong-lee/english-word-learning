<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ì¸ì´ì˜ ì˜ë‹¨ì–´ í•™ìŠµ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="width: 100px;"></div>
            <h1>ì„¸ì¸ì´ì˜ ì˜ë‹¨ì–´ í•™ìŠµ</h1>
            <a href="/admin" class="admin-link">ë‹¨ì–´ ê´€ë¦¬</a>
        </div>
        
        <div class="score-board">
            <div class="score-item">
                <div class="score-label">ì •ë‹µ</div>
                <div class="score-value correct-score" id="correctScore">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">ì˜¤ë‹µ</div>
                <div class="score-value incorrect-score" id="incorrectScore">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">ì •ë‹µë¥ </div>
                <div class="score-value accuracy-score" id="accuracyScore">0%</div>
            </div>
            <button class="reset-score" onclick="resetScores()">ì´ˆê¸°í™”</button>
        </div>
        
        <!-- ì˜¤ë””ì˜¤ ìš”ì†Œ ì¶”ê°€ -->
        <audio id="correctSound" preload="auto">
            <source src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" type="audio/ogg">
        </audio>
        <audio id="incorrectSound" preload="auto">
            <source src="https://actions.google.com/sounds/v1/cartoon/cartoon_cowbell.ogg" type="audio/ogg">
        </audio>
        
        <div class="word-container">
            <button class="speak-button" onclick="speakWord()" title="ë°œìŒ ë“£ê¸°">
                <i class="fas fa-volume-up"></i>
            </button>
            <div class="word-type" id="wordType"></div>
            <div style="font-size: 1.2em; color: #666;">
                ë°œìŒì„ ë“£ê³  ë‹¨ì–´ì™€ ëœ»ì„ ì…ë ¥í•˜ì„¸ìš”
            </div>
        </div>

        <div class="input-container">
            <div class="input-group">
                <label class="input-label">ì˜ì–´ ìŠ¤í ë§:</label>
                <input type="text" id="answer" placeholder="ì˜ì–´ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
            </div>
            <div class="input-group">
                <label class="input-label">í•œê¸€ ëœ»:</label>
                <input type="text" id="meaning" placeholder="ë‹¨ì–´ì˜ ëœ»ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
            </div>
            <button onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
            <button onclick="getNewWord()" style="margin-top: 10px; background: #4CAF50;">ë‹¤ìŒ ë‹¨ì–´</button>
        </div>

        <div class="result" id="result"></div>
    </div>

    <script>
        let currentWord = '';
        let currentMeaning = '';
        let hasCountedIncorrect = false;  // í˜„ì¬ ë‹¨ì–´ì˜ ì˜¤ë‹µ ì¹´ìš´íŠ¸ ì—¬ë¶€
        const synth = window.speechSynthesis;

        // ì ìˆ˜ ê´€ë¦¬
        let scores = {
            correct: parseInt(localStorage.getItem('correctScore') || '0'),
            incorrect: parseInt(localStorage.getItem('incorrectScore') || '0')
        };

        function updateScoreDisplay() {
            document.getElementById('correctScore').textContent = scores.correct;
            document.getElementById('incorrectScore').textContent = scores.incorrect;
            
            const total = scores.correct + scores.incorrect;
            const accuracy = total > 0 ? Math.round((scores.correct / total) * 100) : 0;
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('correctScore', scores.correct);
            localStorage.setItem('incorrectScore', scores.incorrect);
        }

        function resetScores() {
            scores.correct = 0;
            scores.incorrect = 0;
            updateScoreDisplay();
            // ê²°ê³¼ ë©”ì‹œì§€ë„ í•¨ê»˜ ì´ˆê¸°í™”
            document.getElementById('result').textContent = '';
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        updateScoreDisplay();

        function speakWord() {
            if (!currentWord) return;
            
            // ì´ì „ ìŒì„±ì´ ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€
            synth.cancel();

            // ê²°ê³¼ ë©”ì‹œì§€ ì‚­ì œ
            document.getElementById('result').textContent = '';

            const utterance = new SpeechSynthesisUtterance(currentWord);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            synth.speak(utterance);
        }

        function getNewWord() {
            fetch('/get_word')
                .then(response => response.json())
                .then(data => {
                    currentWord = data.word;
                    currentMeaning = data.meaning;
                    hasCountedIncorrect = false;  // ìƒˆ ë‹¨ì–´ë¡œ ë³€ê²½ì‹œ ì´ˆê¸°í™”
                    document.getElementById('wordType').textContent = data.type;
                    document.getElementById('answer').value = '';
                    document.getElementById('meaning').value = '';
                    // ìë™ìœ¼ë¡œ ë°œìŒ ì¬ìƒ
                    speakWord();
                });
        }

        function checkAnswer() {
            const answer = document.getElementById('answer').value.toLowerCase();
            const meaning = document.getElementById('meaning').value;
            
            fetch('/check_answer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    answer: answer,
                    meaning: meaning,
                    word: currentWord,
                    correct_meaning: currentMeaning
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultElement = document.getElementById('result');
                if (data.correct) {
                    document.getElementById('correctSound').play()
                        .catch(e => console.log('íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', e));
                    resultElement.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘';
                    resultElement.className = 'result correct';
                    scores.correct++;
                    
                    // ì •ë‹µì¸ ê²½ìš°ì—ë§Œ 1ì´ˆ í›„ ë‹¤ìŒ ë‹¨ì–´ë¡œ ì´ë™
                    setTimeout(() => {
                        getNewWord();
                    }, 1000);
                } else {
                    document.getElementById('incorrectSound').play()
                        .catch(e => console.log('íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', e));
                    resultElement.textContent = `í‹€ë ¸ìŠµë‹ˆë‹¤.\nì •ë‹µ: ${data.correct_answer} - ${data.correct_meaning}`;
                    resultElement.className = 'result incorrect';
                    
                    // í˜„ì¬ ë‹¨ì–´ì˜ ì²« ì˜¤ë‹µì¸ ê²½ìš°ì—ë§Œ ì¹´ìš´íŠ¸
                    if (!hasCountedIncorrect) {
                        scores.incorrect++;
                        hasCountedIncorrect = true;
                    }
                    
                    // ì˜¤ë‹µì¸ ê²½ìš° ì…ë ¥ í•„ë“œë§Œ ì´ˆê¸°í™”
                    document.getElementById('answer').value = '';
                    document.getElementById('meaning').value = '';
                }
                updateScoreDisplay();
            });
        }

        // Enter í‚¤ë¡œ ì •ë‹µ ì œì¶œ (ë§ˆì§€ë§‰ ì…ë ¥ í•„ë“œì—ì„œ)
        document.getElementById('meaning').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // í˜ì´ì§€ ë¡œë“œì‹œ ì²« ë‹¨ì–´ ê°€ì ¸ì˜¤ê¸°
        getNewWord();
    </script>
</body>
</html> 